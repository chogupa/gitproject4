<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>ã‚²ãƒ¼ãƒ ç”»é¢</title>
	<link rel="stylesheet" href="../../static/style.css" th:href="@{/style.css}">
</head>

<body>
	<table>
		<tr th:each="row : ${#numbers.sequence(0,4)}">
			<td th:each="col : ${#numbers.sequence(0,4)}" th:with="cell=${dbList[row * 5 + col]}"
				th:attr="data-id=${cell.id}, data-flag=${cell.flag}, data-bomb=${cell.bomb}, data-count=${cell.count}"
				th:text="' '">
			</td>
		</tr>
	</table>

	<script>
		//å…¨ã¦ã®ãƒã‚¹ã‚’å–å¾—ã™ã‚‹
		document.querySelectorAll('td[data-id]').forEach(td => {
			const id = td.getAttribute('data-id') //ãƒã‚¹ã®IDå–å¾—
			const count = td.getAttribute('data-count'); // æ•°å­—å–å¾—

			let revealed = false; //ãƒã‚¹ãŒé–‹ã„ã¦ã‚‹ã‹
			let flagged = false; //æ——ãŒç«‹ã£ã¦ã„ã‚‹ã‹

			// å·¦ã‚¯ãƒªãƒƒã‚¯ã§é–‹ã
			td.addEventListener('click', () => {
				if (revealed || flagged) return; // ã™ã§ã«é–‹ã„ã¦ã‚‹ãƒ»æ——ã‚ã‚‹
				revealed = true;
				if(count === '2') {
				      // åœ°é›·åˆ¤å®š
				      td.textContent = 'ğŸ’£';
				      td.style.backgroundColor = 'red';
				      // ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ç”»é¢
				      window.location.href = '/gameover'; 
				    } else if (count === '1') {
				      // å®‰å…¨ãƒã‚¹
				      td.textContent = ' ';
				    } else {
				      // ãã‚Œä»¥å¤–ã®æ•°å€¤ãŒã‚ã‚Œã°è¡¨ç¤º
				      td.textContent = count;
				    }
				  });
				  

			// å³ã‚¯ãƒªãƒƒã‚¯ã§æ——ã‚’ç«‹ã¦ã‚‹
			td.addEventListener('contextmenu', e => {
				e.preventDefault(); //ãƒ¡ãƒ‹ãƒ¥ãƒ¼å‡ºãªã„ã‚ˆã†ã«
				if (revealed) return;

				flagged = !flagged; //æ——ã‚’ç«‹ã¦ã‚‹ãƒ»å¤–ã™
				if (flagged) {
					td.classList.add('flagged');
					td.textContent = 'ğŸš©';
				} else {
					td.classList.remove('flagged');
					td.textContent = '';
				}
			});
		});
	</script>
</body>

</html>